{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}انتخاب روش پرداخت - برج سفید{% endblock %}

{% block extra_css %}
<style>
    .payment-container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .payment-header {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 40px;
        border-radius: 16px;
        text-align: center;
        margin-bottom: 40px;
    }
    .payment-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    .option-card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        transition: all 0.3s;
    }
    .option-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    .option-icon {
        font-size: 4em;
        color: #2a5298;
        margin-bottom: 20px;
    }
    .option-title {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 10px;
    }
    .option-desc {
        color: #666;
        margin-bottom: 20px;
    }
    .option-btn {
        background: #2a5298;
        color: white;
        border: none;
        padding: 14px 40px;
        border-radius: 10px;
        font-size: 1.1em;
        cursor: pointer;
        width: 100%;
    }
    .wallet-balance {
        font-size: 1.8em;
        font-weight: bold;
        color: #2a5298;
        margin: 20px 0;
    }
    .warning {
        color: #e74c3c;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="payment-container">
    <div class="payment-header">
        <h1>انتخاب روش پرداخت</h1>
        <p>مبلغ قابل پرداخت: {{ booking.total_price|intcomma }} تومان</p>
    </div>

    <div class="payment-options">
        <!-- گزینه کیف پول -->
        <div class="option-card">
            <div class="option-icon"><i class="fas fa-wallet"></i></div>
            <div class="option-title">پرداخت از کیف پول</div>
            <div class="option-desc">
                موجودی کیف پول شما:
                <div class="wallet-balance">{{ user.profile.wallet_balance|intcomma }} تومان</div>
                {% if user.profile.wallet_balance >= booking.total_price %}
                    موجودی کافی است
                {% else %}
                    <span class="warning">موجودی کافی نیست</span>
                {% endif %}
            </div>
            <a href="{% url 'payments:pay_with_wallet' booking.pk %}" 
               class="option-btn" 
               {% if user.profile.wallet_balance < booking.total_price %}style="opacity: 0.5; pointer-events: none;"{% endif %}>
                پرداخت از کیف پول
            </a>
        </div>

        <!-- گزینه خرید اعتباری -->
        <div class="option-card">
            <div class="option-icon"><i class="fas fa-credit-card"></i></div>
            <div class="option-title">خرید اعتباری (قسطی)</div>
            <div class="option-desc">
                بدون نیاز به پرداخت نقدی، قسطی بخرید
            </div>
            <a href="{% url 'payments:credit_purchase' booking.pk %}" class="option-btn">
                خرید اعتباری
            </a>
        </div>

        <!-- گزینه درگاه آنلاین -->
        <div class="option-card">
            <div class="option-icon"><i class="fas fa-university"></i></div>
            <div class="option-title">پرداخت آنلاین</div>
            <div class="option-desc">
                پرداخت امن با کلیه کارت‌های بانکی
            </div>
            <a href="{% url 'payments:initiate_zarinpal' booking.pk %}" class="option-btn">
                پرداخت با زرین‌پال
            </a>
        </div>
    </div>
</div>
{% endblock %}

